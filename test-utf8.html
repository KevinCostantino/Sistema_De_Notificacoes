<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste UTF-8 - Sistema de Notifica√ß√µes</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Teste UTF-8 - Sistema de Notifica√ß√µes</h1>
    
    <h2>1. Criar notifica√ß√£o com acentos</h2>
    <button onclick="testarUTF8()">üáßüá∑ Criar Notifica√ß√£o PT-BR</button>
    
    <h2>2. Listar notifica√ß√µes</h2>
    <button onclick="listarNotificacoes()">üìã Listar Notifica√ß√µes</button>
    
    <div id="resultado"></div>
    
    <h2>Resposta da API:</h2>
    <textarea id="resposta" readonly></textarea>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        const USER_ID = '673e4b8f9a1b2c3d4e5f6789';
        
        function mostrarResultado(msg, sucesso = true) {
            document.getElementById('resultado').innerHTML = 
                `<div class="result ${sucesso ? 'success' : 'error'}">${msg}</div>`;
        }
        
        function mostrarResposta(data) {
            document.getElementById('resposta').value = JSON.stringify(data, null, 2);
        }
        
        async function testarUTF8() {
            try {
                const notificacao = {
                    userId: USER_ID,
                    title: "üáßüá∑ Notifica√ß√£o com Acentua√ß√£o",
                    message: "Esta mensagem cont√©m caracteres especiais do portugu√™s: a√ß√£o, informa√ß√£o, cora√ß√£o, cria√ß√£o, aten√ß√£o, configura√ß√£o. Tamb√©m temos: √ß, √£, √µ, √©, √≠, √≥, √∫, √†, √¢, √™!",
                    type: "success",
                    priority: "high"
                };
                
                const response = await fetch(`${API_BASE}/notifications`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify(notificacao)
                });
                
                const data = await response.json();
                mostrarResposta(data);
                
                if (data.success) {
                    mostrarResultado(`‚úÖ Notifica√ß√£o criada! ID: ${data.data._id}`);
                } else {
                    mostrarResultado(`‚ùå Erro: ${data.message}`, false);
                }
            } catch (error) {
                mostrarResultado(`‚ùå Erro de rede: ${error.message}`, false);
            }
        }
        
        async function listarNotificacoes() {
            try {
                const response = await fetch(`${API_BASE}/notifications/user/${USER_ID}?limit=3`);
                const data = await response.json();
                mostrarResposta(data);
                
                if (data.success && data.data.length > 0) {
                    const primeira = data.data[0];
                    const temAcentos = /[√†√°√¢√£√§√ß√®√©√™√´√¨√≠√Æ√Ø√±√≤√≥√¥√µ√∂√π√∫√ª√º√Ω]/i.test(primeira.title + primeira.message);
                    
                    if (temAcentos) {
                        mostrarResultado(`‚úÖ UTF-8 funcionando! T√≠tulo: "${primeira.title}"`);
                    } else {
                        mostrarResultado(`‚ö†Ô∏è Sem acentos encontrados na primeira notifica√ß√£o`);
                    }
                } else {
                    mostrarResultado(`‚ùå Nenhuma notifica√ß√£o encontrada`, false);
                }
            } catch (error) {
                mostrarResultado(`‚ùå Erro de rede: ${error.message}`, false);
            }
        }
    </script>
</body>
</html>